var layerMvc=function(){function h(a,b){var c=parseInt(a.target.id.substr("4")),f=d[e].list;f[c].x=b.position.left;f[c].y=b.position.top}function n(a){return'<div class="res" style="width:24px; height: 24px;" id="box-'+a+'"><img src="/res/img/loader.gif" id="img-'+a+'"><div class="panel"><img src="http://theme.codecampus.ru/plugin/icons/img/delete-16.png" type="rm"></div></div>'}function p(a){setTimeout(function(){for(var b in a){var c=new Image,f=d[e].list;c.src=f[a[b]].src;c.numTmp=a[b];c.onload=
function(){var a=document.getElementById("img-"+this.numTmp);a.parentNode.replaceChild(this,a);jQuery(this).attr("type",f[this.numTmp].type);a=d[e].list[this.numTmp];jQuery("#box-"+this.numTmp).css({width:this.width+"px",height:this.height+"px",top:a.y+"px",left:a.x+"px",position:"absolute"})}}},200)}function t(a){q(a.data,"img")}function q(a,b){var c="",f=[],g=d[e].list,l;for(l in a.list)++j,f.push(j),g[j]={x:0,y:0,type:b,src:"img"==b?a.list[l]:a.list[l]+"preview.png",id:l},"swf"==b&&(g[j].swf=a.list[l]+
"data.swf"),c+=n(j,b);k=d[e].newResId=j;jQuery("#sliderShowBox").append(c);for(var m in f)jQuery("#box-"+f[m]).draggable({containment:"#sliderShowBox",scroll:!1,stop:h,cancel:".panel"});p(f)}function u(){if(null==e)alert("\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435/\u0441\u043e\u0437\u0434\u0430\u0439\u0442\u0435 \u0441\u043b\u043e\u0439");else if(null!=g)return g.contentWindow.postMessage({action:"show",group:r,subgroup:"layer",profile:"livevideo"},"http://files.codecampus.ru/"),!1}function v(a){var b=
jQuery(a.target).attr("type");if(b){a=jQuery(a.target).parents(".res:first").attr("id").substr(4);a=parseInt(a);switch(b){case "rm":if(!confirm("\u0423\u0434\u0430\u043b\u0438\u0442\u044c?"))break;delete d[e].list[a];jQuery("#box-"+a).remove();break;case "swf":if(a==k)return;var c=d[e].list[a];jQuery("#swfParamBox").html("").load("swf/"+c.name+".html",function(){pluginSwfMvc.init({isInit:!1},c.swfData)});k=a;break;case "img":k=a,jQuery("#swfParamBox").html("")}return!1}}function w(){var a=document.getElementById("layerName").value.trim();
if(""==a)alert("\u041d\u0435\u043b\u044c\u0437\u044f \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0441 \u043f\u0443\u0441\u0442\u044b\u043c \u0438\u043c\u0435\u043d\u0435\u043c");else return document.getElementById("layerName").value="",a=$("<div/>").text(a).html(),++m,d[m]={name:a,list:{},newResId:0},s(m,a),!1}function s(a,b){jQuery("#layerList").append('<li class="item" id="lr-'+a+'" type="view"><img src="http://theme.codecampus.ru/plugin/icons/img/delete-16.png" type="rm"/>'+b+"</li>")}function x(a){var b=
jQuery(a.target).attr("type");if(b){var c=jQuery(a.target).attr("id");c||(c=jQuery(a.target).parents(".item:first").attr("id"));c=parseInt(c.substr(3));if(e!=c){switch(b){case "rm":if(!confirm("\u0423\u0434\u0430\u043b\u0438\u0442\u044c?"))break;e=null;jQuery("#sliderShowBox .res").remove();jQuery("#lr-"+c).remove();delete d[c];jQuery("#swfParamBox").html("");break;default:e=c;jQuery("#layerList .select:first").removeClass("select");jQuery("#lr-"+c).addClass("select");jQuery("#sliderShowBox .res").remove();
a=d[c].list;var b=[],c="",f;for(f in a)c+=n(f,a[f].type),b.push(f);j=d[e].newResId;jQuery("#sliderShowBox").append(c);for(var g in b)console.log("#box-"+b[g]),jQuery("#box-"+b[g]).draggable({containment:"#sliderShowBox",scroll:!1,stop:h,cancel:".panel"});p(b);jQuery("#swfParamBox").html("");k=null}return!1}}}function y(a){var b=a.target.value;"none"!=b&&(a.target.value="none",null==e?alert("\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435/\u0441\u043e\u0437\u0434\u0430\u0439\u0442\u0435 \u0441\u043b\u043e\u0439"):
jQuery("#swfParamBox").load("/admin/layer/swf/"+b+".html",function(){pluginSwfMvc.init({isInit:!0})}))}function z(){if(null==layerMvc.layerWinCallback)return!1;layerMvc.layerWinCallback(d);window.close();return!1}function A(a){27==a.keyCode&&window.close()}var g=null,d={},j=0,m=0,e=null,k=null,r;return{init:function(){r=document.location.hash.substr(1);g=document.createElement("IFRAME");g.setAttribute("src","http://files.codecampus.ru/bridge/?host="+document.location.host+"&PHPSESSID="+jQuery.cookie("PHPSESSID"));
g.style.width="1px";g.style.height="1px";g.style.visibility="hidden";document.body.appendChild(g);var a=window.addEventListener?"addEventListener":"attachEvent";(0,window[a])("attachEvent"==a?"onmessage":"message",t,!1);jQuery("#resImagBtn").click(u);jQuery("#sliderShowBox").mousedown(v);jQuery("#layerAddBtn").click(w);jQuery("#layerList").click(x);jQuery("#swfList").change(y);jQuery("#saveBtn").click(z);jQuery(window).keypress(A)},initSwfPlugin:function(a){q(a,"swf");d[e].list[k].name=a.name},setSwfPluginData:function(a){d[e].list[k].swfData=
a},setLayerList:function(a){d=a;for(var b in a)s(b,a[b].name)},layerWinCallback:null}}();jQuery(document).ready(function(){layerMvc.init()});jQuery.fn.serializeObject=function(){var h={},n=this.serializeArray();$.each(n,function(){void 0!==h[this.name]?(h[this.name].push||(h[this.name]=[h[this.name]]),h[this.name].push(this.value||"")):h[this.name]=this.value||""});return h};